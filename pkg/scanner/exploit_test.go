package scanner

import (
	"encoding/hex"
	"fmt"
	"github.com/wjlin0/CVE-2024-23897/pkg/output"
	"strings"
	"testing"
)

func TestParseResponseData(t *testing.T) {
	helpFullText := "00 00 00 00 86 08 77 77 77 2D 64 61 74 61 3A 78 3A 33 33 3A 33 33 3A 77 77 77 2D 64 61 74 61 3A 2F 76 61 72 2F 77 77 77 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 77 77 77 2D 64 61 74 61 3A 78 3A 33 33 3A 33 33 3A 77 77 77 2D 64 61 74 61 3A 2F 76 61 72 2F 77 77 77 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 5C 08 72 6F 6F 74 3A 78 3A 30 3A 30 3A 72 6F 6F 74 3A 2F 72 6F 6F 74 3A 2F 62 69 6E 2F 62 61 73 68 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 72 6F 6F 74 3A 78 3A 30 3A 30 3A 72 6F 6F 74 3A 2F 72 6F 6F 74 3A 2F 62 69 6E 2F 62 61 73 68 E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 74 08 6D 61 69 6C 3A 78 3A 38 3A 38 3A 6D 61 69 6C 3A 2F 76 61 72 2F 6D 61 69 6C 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 6D 61 69 6C 3A 78 3A 38 3A 38 3A 6D 61 69 6C 3A 2F 76 61 72 2F 6D 61 69 6C 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 86 08 62 61 63 6B 75 70 3A 78 3A 33 34 3A 33 34 3A 62 61 63 6B 75 70 3A 2F 76 61 72 2F 62 61 63 6B 75 70 73 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 62 61 63 6B 75 70 3A 78 3A 33 34 3A 33 34 3A 62 61 63 6B 75 70 3A 2F 76 61 72 2F 62 61 63 6B 75 70 73 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 7E 08 5F 61 70 74 3A 78 3A 31 30 30 3A 36 35 35 33 34 3A 3A 2F 6E 6F 6E 65 78 69 73 74 65 6E 74 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 5F 61 70 74 3A 78 3A 31 30 30 3A 36 35 35 33 34 3A 3A 2F 6E 6F 6E 65 78 69 73 74 65 6E 74 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 C0 08 67 6E 61 74 73 3A 78 3A 34 31 3A 34 31 3A 47 6E 61 74 73 20 42 75 67 2D 52 65 70 6F 72 74 69 6E 67 20 53 79 73 74 65 6D 20 28 61 64 6D 69 6E 29 3A 2F 76 61 72 2F 6C 69 62 2F 67 6E 61 74 73 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 67 6E 61 74 73 3A 78 3A 34 31 3A 34 31 3A 47 6E 61 74 73 20 42 75 67 2D 52 65 70 6F 72 74 69 6E 67 20 53 79 73 74 65 6D 20 28 61 64 6D 69 6E 29 3A 2F 76 61 72 2F 6C 69 62 2F 67 6E 61 74 73 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 92 08 6E 6F 62 6F 64 79 3A 78 3A 36 35 35 33 34 3A 36 35 35 33 34 3A 6E 6F 62 6F 64 79 3A 2F 6E 6F 6E 65 78 69 73 74 65 6E 74 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 6E 6F 62 6F 64 79 3A 78 3A 36 35 35 33 34 3A 36 35 35 33 34 3A 6E 6F 62 6F 64 79 3A 2F 6E 6F 6E 65 78 69 73 74 65 6E 74 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 76 08 6C 70 3A 78 3A 37 3A 37 3A 6C 70 3A 2F 76 61 72 2F 73 70 6F 6F 6C 2F 6C 70 64 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 6C 70 3A 78 3A 37 3A 37 3A 6C 70 3A 2F 76 61 72 2F 73 70 6F 6F 6C 2F 6C 70 64 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 84 08 75 75 63 70 3A 78 3A 31 30 3A 31 30 3A 75 75 63 70 3A 2F 76 61 72 2F 73 70 6F 6F 6C 2F 75 75 63 70 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 75 75 63 70 3A 78 3A 31 30 3A 31 30 3A 75 75 63 70 3A 2F 76 61 72 2F 73 70 6F 6F 6C 2F 75 75 63 70 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 66 08 62 69 6E 3A 78 3A 32 3A 32 3A 62 69 6E 3A 2F 62 69 6E 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 62 69 6E 3A 78 3A 32 3A 32 3A 62 69 6E 3A 2F 62 69 6E 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 80 08 6E 65 77 73 3A 78 3A 39 3A 39 3A 6E 65 77 73 3A 2F 76 61 72 2F 73 70 6F 6F 6C 2F 6E 65 77 73 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 6E 65 77 73 3A 78 3A 39 3A 39 3A 6E 65 77 73 3A 2F 76 61 72 2F 73 70 6F 6F 6C 2F 6E 65 77 73 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 72 08 70 72 6F 78 79 3A 78 3A 31 33 3A 31 33 3A 70 72 6F 78 79 3A 2F 62 69 6E 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 70 72 6F 78 79 3A 78 3A 31 33 3A 31 33 3A 70 72 6F 78 79 3A 2F 62 69 6E 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 76 08 69 72 63 3A 78 3A 33 39 3A 33 39 3A 69 72 63 64 3A 2F 72 75 6E 2F 69 72 63 64 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 69 72 63 3A 78 3A 33 39 3A 33 39 3A 69 72 63 64 3A 2F 72 75 6E 2F 69 72 63 64 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 98 08 6C 69 73 74 3A 78 3A 33 38 3A 33 38 3A 4D 61 69 6C 69 6E 67 20 4C 69 73 74 20 4D 61 6E 61 67 65 72 3A 2F 76 61 72 2F 6C 69 73 74 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 6C 69 73 74 3A 78 3A 33 38 3A 33 38 3A 4D 61 69 6C 69 6E 67 20 4C 69 73 74 20 4D 61 6E 61 67 65 72 3A 2F 76 61 72 2F 6C 69 73 74 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 7C 08 67 61 6D 65 73 3A 78 3A 35 3A 36 30 3A 67 61 6D 65 73 3A 2F 75 73 72 2F 67 61 6D 65 73 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 67 61 6D 65 73 3A 78 3A 35 3A 36 30 3A 67 61 6D 65 73 3A 2F 75 73 72 2F 67 61 6D 65 73 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 7C 08 6D 61 6E 3A 78 3A 36 3A 31 32 3A 6D 61 6E 3A 2F 76 61 72 2F 63 61 63 68 65 2F 6D 61 6E 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 6D 61 6E 3A 78 3A 36 3A 31 32 3A 6D 61 6E 3A 2F 76 61 72 2F 63 61 63 68 65 2F 6D 61 6E 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 7C 08 64 61 65 6D 6F 6E 3A 78 3A 31 3A 31 3A 64 61 65 6D 6F 6E 3A 2F 75 73 72 2F 73 62 69 6E 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 64 61 65 6D 6F 6E 3A 78 3A 31 3A 31 3A 64 61 65 6D 6F 6E 3A 2F 75 73 72 2F 73 62 69 6E 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 66 08 73 79 73 3A 78 3A 33 3A 33 3A 73 79 73 3A 2F 64 65 76 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 73 79 73 3A 78 3A 33 3A 33 3A 73 79 73 3A 2F 64 65 76 3A 2F 75 73 72 2F 73 62 69 6E 2F 6E 6F 6C 6F 67 69 6E E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 62 08 73 79 6E 63 3A 78 3A 34 3A 36 35 35 33 34 3A 73 79 6E 63 3A 2F 62 69 6E 3A 2F 62 69 6E 2F 73 79 6E 63 3A 20 4E 6F 20 73 75 63 68 20 69 74 65 6D 20 E2 80 98 73 79 6E 63 3A 78 3A 34 3A 36 35 35 33 34 3A 73 79 6E 63 3A 2F 62 69 6E 3A 2F 62 69 6E 2F 73 79 6E 63 E2 80 99 20 65 78 69 73 74 73 2E 0A 00 00 00 01 08 0A 00 00 00 51 08 45 52 52 4F 52 3A 20 45 72 72 6F 72 20 6F 63 63 75 72 72 65 64 20 77 68 69 6C 65 20 70 65 72 66 6F 72 6D 69 6E 67 20 74 68 69 73 20 63 6F 6D 6D 61 6E 64 2C 20 73 65 65 20 70 72 65 76 69 6F 75 73 20 73 74 64 65 72 72 20 6F 75 74 70 75 74 2E 0A 00 00 00 04 04 00 00 00 05"
	// 转换16进制
	helpFullText = strings.ReplaceAll(helpFullText, " ", "") // 移除空格
	bytes, err := hex.DecodeString(helpFullText)
	if err != nil {
		t.Error(err)
		return
	}
	data, err := parseResponseData(output.ModeReadFile, "reload-job", bytes[1:len(bytes)-1])
	if err != nil {
		t.Error(err)
		return
	}
	fmt.Println(string(data))

}
